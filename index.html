<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì—°ì°¨ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

<!-- Firebase CDN (compat ë²„ì „ - GitHub Pages í˜¸í™˜) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<!-- SheetJS ì—‘ì…€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
  :root {
    --bg: #0f0f13; --surface: #1a1a22; --surface2: #22222e; --border: #2e2e3e;
    --accent: #7c6af7; --accent2: #f76a8a; --accent3: #6af7b8; --accent4: #f7c76a;
    --text: #e8e8f0; --text2: #9090a8; --text3: #5a5a72;
    --approved: #6af7b8; --pending: #f7c76a; --rejected: #f76a8a;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

  .loading-overlay { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 999; gap: 16px; transition: opacity 0.3s; }
  .loading-overlay.hide { opacity: 0; pointer-events: none; }
  .loading-spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text { color: var(--text2); font-size: 14px; }

  .header { background: var(--surface); border-bottom: 1px solid var(--border); padding: 20px 40px; display: flex; align-items: center; gap: 16px; position: sticky; top: 0; z-index: 100; }
  .header-logo { width: 36px; height: 36px; background: var(--accent); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
  .header h1 { font-size: 18px; font-weight: 700; letter-spacing: -0.5px; }
  .header-right { margin-left: auto; display: flex; align-items: center; gap: 12px; }
  .header-date { color: var(--text2); font-size: 13px; }

  .admin-badge { display: flex; align-items: center; gap: 6px; background: #7c6af720; border: 1px solid #7c6af740; border-radius: 20px; padding: 4px 12px; font-size: 12px; font-weight: 600; color: var(--accent); }
  .admin-login-btn { display: flex; align-items: center; gap: 6px; background: var(--surface2); border: 1px solid var(--border); border-radius: 20px; padding: 6px 14px; font-size: 12px; font-weight: 600; color: var(--text2); cursor: pointer; font-family: 'Noto Sans KR', sans-serif; transition: all 0.15s; }
  .admin-login-btn:hover { border-color: var(--accent); color: var(--accent); }
  .admin-logout-btn { background: none; border: none; color: var(--text3); font-size: 11px; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; padding: 4px 8px; border-radius: 6px; transition: all 0.15s; }
  .admin-logout-btn:hover { color: var(--accent2); background: #f76a8a10; }

  .nav-tabs { display: flex; gap: 4px; padding: 20px 40px 0; border-bottom: 1px solid var(--border); background: var(--surface); }
  .tab-btn { padding: 10px 22px; border: none; background: none; color: var(--text2); font-family: 'Noto Sans KR', sans-serif; font-size: 14px; font-weight: 500; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.2s; }
  .tab-btn:hover { color: var(--text); }
  .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }
  .tab-btn.admin-tab { color: var(--accent); }

  .section { display: none; padding: 32px 40px; }
  .section.active { display: block; }

  .login-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.75); display: flex; align-items: center; justify-content: center; z-index: 300; opacity: 0; pointer-events: none; transition: opacity 0.25s; backdrop-filter: blur(4px); }
  .login-overlay.show { opacity: 1; pointer-events: all; }
  .login-box { background: var(--surface); border: 1px solid var(--border); border-radius: 20px; padding: 36px; width: 360px; transform: scale(0.95) translateY(10px); transition: transform 0.25s; text-align: center; }
  .login-overlay.show .login-box { transform: scale(1) translateY(0); }
  .login-icon { width: 60px; height: 60px; background: linear-gradient(135deg, #7c6af7, #a06af7); border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 28px; margin: 0 auto 20px; box-shadow: 0 8px 24px #7c6af730; }
  .login-box h2 { font-size: 20px; font-weight: 700; margin-bottom: 6px; }
  .login-box p { color: var(--text2); font-size: 13px; line-height: 1.6; margin-bottom: 24px; }
  .login-input { width: 100%; background: var(--surface2); border: 1px solid var(--border); color: var(--text); border-radius: 10px; padding: 12px 16px; font-family: 'Noto Sans KR', sans-serif; font-size: 16px; outline: none; text-align: center; letter-spacing: 4px; transition: border-color 0.2s; margin-bottom: 10px; }
  .login-input:focus { border-color: var(--accent); }
  .login-input.error { border-color: var(--rejected); animation: shake 0.3s; }
  @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }
  .login-error { color: var(--rejected); font-size: 12px; margin-bottom: 10px; min-height: 18px; }
  .login-btn { width: 100%; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 10px; font-family: 'Noto Sans KR', sans-serif; font-size: 15px; font-weight: 700; cursor: pointer; transition: all 0.15s; margin-bottom: 10px; }
  .login-btn:hover { background: #6a58e0; }
  .login-cancel-btn { background: none; border: none; color: var(--text3); font-size: 13px; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; padding: 6px; }

  .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
  .section-title { font-size: 22px; font-weight: 700; }
  .section-desc { color: var(--text2); font-size: 13px; margin-top: 4px; }

  .apply-layout { display: grid; grid-template-columns: 1fr 360px; gap: 24px; }

  .calendar-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; }
  .cal-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 24px; border-bottom: 1px solid var(--border); }
  .cal-nav { display: flex; gap: 8px; }
  .cal-nav button { width: 32px; height: 32px; border: 1px solid var(--border); background: var(--surface2); color: var(--text); border-radius: 8px; cursor: pointer; font-size: 14px; transition: all 0.15s; }
  .cal-nav button:hover { border-color: var(--accent); color: var(--accent); }
  .cal-month { font-size: 18px; font-weight: 700; }
  .cal-year { color: var(--text2); font-size: 14px; margin-left: 8px; }
  .cal-grid { padding: 16px; }
  .cal-days-header { display: grid; grid-template-columns: repeat(7,1fr); text-align: center; margin-bottom: 8px; }
  .cal-days-header span { font-size: 11px; font-weight: 500; color: var(--text3); padding: 4px; letter-spacing: 1px; }
  .cal-cells { display: grid; grid-template-columns: repeat(7,1fr); gap: 3px; }
  .cal-cell { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; font-size: 13px; cursor: pointer; transition: all 0.15s; position: relative; user-select: none; }
  .cal-cell:hover:not(.empty) { background: var(--surface2); }
  .cal-cell.today { font-weight: 700; color: var(--accent); }
  .cal-cell.today::after { content:''; position:absolute; bottom:4px; width:4px; height:4px; background:var(--accent); border-radius:50%; }
  .cal-cell.selected { background: var(--accent); color: white; font-weight: 600; }
  .cal-cell.empty { color: var(--text3); cursor: default; }
  .cal-cell.sunday { color: #f76a8a88; }
  .cal-cell.saturday { color: #6a9af788; }
  .cal-cell.selected.sunday, .cal-cell.selected.saturday { color: white; }
  .leave-dots { display: flex; gap: 2px; margin-top: 1px; }
  .leave-dot { width: 3px; height: 3px; border-radius: 50%; }

  .apply-form { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 24px; display: flex; flex-direction: column; gap: 16px; }
  .form-title { font-size: 16px; font-weight: 700; }
  .form-group { display: flex; flex-direction: column; gap: 6px; }
  .form-label { font-size: 12px; color: var(--text2); font-weight: 500; letter-spacing: 0.5px; }
  .form-select, .form-input { background: var(--surface2); border: 1px solid var(--border); color: var(--text); border-radius: 8px; padding: 10px 12px; font-family: 'Noto Sans KR', sans-serif; font-size: 14px; outline: none; transition: border-color 0.2s; }
  .form-select:focus, .form-input:focus { border-color: var(--accent); }
  .form-select option { background: var(--surface2); }
  .date-range-display { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; font-size: 13px; color: var(--text2); min-height: 40px; }
  .date-range-display.filled { color: var(--text); font-weight: 500; }
  .leave-type-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .leave-type-btn { padding: 8px; border: 1px solid var(--border); background: var(--surface2); color: var(--text2); border-radius: 8px; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; font-size: 13px; transition: all 0.15s; }
  .leave-type-btn:hover { border-color: var(--accent); color: var(--accent); }
  .leave-type-btn.active { border-color: var(--accent); background: #7c6af715; color: var(--accent); }
  .submit-btn { padding: 12px; background: var(--accent); color: white; border: none; border-radius: 10px; font-family: 'Noto Sans KR', sans-serif; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.15s; margin-top: 4px; }
  .submit-btn:hover { background: #6a58e0; transform: translateY(-1px); }
  .submit-btn:disabled { background: var(--surface2); color: var(--text3); cursor: not-allowed; transform: none; }
  .remaining-info { background: var(--surface2); border-radius: 8px; padding: 12px; display: flex; justify-content: space-between; font-size: 13px; }
  .remaining-info span { color: var(--text2); }
  .remaining-info strong { color: var(--accent3); }
  .cal-legend { padding: 12px 16px; border-top: 1px solid var(--border); display: flex; gap: 16px; flex-wrap: wrap; }
  .legend-item { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--text2); }
  .legend-dot { width: 8px; height: 8px; border-radius: 50%; }

  .stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px,1fr)); gap: 16px; margin-bottom: 32px; }
  .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 20px 24px; }
  .stat-card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
  .employee-name { font-size: 16px; font-weight: 700; }
  .employee-avatar { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: white; }
  .stat-bars { display: flex; flex-direction: column; gap: 10px; margin-bottom: 16px; }
  .stat-row { display: flex; flex-direction: column; gap: 4px; }
  .stat-row-header { display: flex; justify-content: space-between; font-size: 12px; color: var(--text2); }
  .stat-bar-bg { height: 6px; background: var(--surface2); border-radius: 3px; overflow: hidden; }
  .stat-bar-fill { height: 100%; border-radius: 3px; transition: width 0.6s ease; }
  .stat-numbers { display: grid; grid-template-columns: repeat(4,1fr); gap: 6px; padding-top: 16px; border-top: 1px solid var(--border); }
  .stat-num { text-align: center; }
  .stat-num-val { font-size: 18px; font-weight: 700; font-family: 'DM Mono', monospace; }
  .stat-num-label { font-size: 10px; color: var(--text2); margin-top: 2px; }

  .table-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; }
  .table-header { padding: 16px 24px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .table-title { font-size: 15px; font-weight: 700; }
  .filter-select { background: var(--surface2); border: 1px solid var(--border); color: var(--text); border-radius: 6px; padding: 6px 10px; font-family: 'Noto Sans KR', sans-serif; font-size: 13px; outline: none; }
  table { width: 100%; border-collapse: collapse; }
  th { text-align: left; padding: 10px 16px; font-size: 11px; font-weight: 600; color: var(--text3); letter-spacing: 0.8px; border-bottom: 1px solid var(--border); background: var(--surface2); }
  td { padding: 12px 16px; font-size: 13px; border-bottom: 1px solid var(--border); vertical-align: middle; }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: var(--surface2); }
  .badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
  .badge-approved { background: #6af7b820; color: var(--approved); }
  .badge-pending { background: #f7c76a20; color: var(--pending); }
  .badge-rejected { background: #f76a8a20; color: var(--rejected); }

  .approval-grid { display: flex; flex-direction: column; gap: 12px; }
  .approval-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 16px 20px; display: flex; align-items: center; gap: 16px; }
  .approval-card.approved { border-left: 3px solid var(--approved); }
  .approval-card.rejected { border-left: 3px solid var(--rejected); }
  .approval-card.pending { border-left: 3px solid var(--pending); }
  .approval-avatar { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; color: white; flex-shrink: 0; }
  .approval-info { flex: 1; }
  .approval-name { font-weight: 700; font-size: 15px; }
  .approval-detail { color: var(--text2); font-size: 13px; margin-top: 3px; }
  .approval-dates { font-family: 'DM Mono', monospace; font-size: 12px; color: var(--text3); margin-top: 4px; }
  .approval-actions { display: flex; gap: 8px; flex-shrink: 0; }
  .btn-approve { padding: 8px 16px; border-radius: 8px; border: 1px solid #6af7b840; background: #6af7b820; color: var(--approved); cursor: pointer; font-family: 'Noto Sans KR', sans-serif; font-size: 13px; font-weight: 700; transition: all 0.15s; }
  .btn-approve:hover { background: #6af7b835; }
  .btn-reject { padding: 8px 16px; border-radius: 8px; border: 1px solid #f76a8a40; background: #f76a8a20; color: var(--rejected); cursor: pointer; font-family: 'Noto Sans KR', sans-serif; font-size: 13px; font-weight: 700; transition: all 0.15s; }
  .btn-reject:hover { background: #f76a8a35; }
  .btn-locked { padding: 8px 16px; border-radius: 8px; background: var(--surface2); color: var(--text3); border: 1px solid var(--border); font-size: 12px; }

  .empty-state { text-align: center; padding: 60px 20px; color: var(--text3); }
  .empty-state .icon { font-size: 40px; margin-bottom: 12px; }
  .empty-state p { font-size: 14px; }

  .toast { position: fixed; bottom: 30px; right: 30px; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 14px 20px; font-size: 14px; display: flex; align-items: center; gap: 10px; box-shadow: 0 8px 32px rgba(0,0,0,0.4); transform: translateY(100px); opacity: 0; transition: all 0.3s ease; z-index: 1000; }
  .toast.show { transform: translateY(0); opacity: 1; }
  .toast.success { border-color: var(--approved); }
  .toast.error { border-color: var(--rejected); }

  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 200; opacity: 0; pointer-events: none; transition: opacity 0.2s; }
  .modal-overlay.show { opacity: 1; pointer-events: all; }
  .modal { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 28px; width: 400px; transform: scale(0.95); transition: transform 0.2s; }
  .modal-overlay.show .modal { transform: scale(1); }
  .modal h3 { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
  .modal p { color: var(--text2); font-size: 14px; line-height: 1.6; white-space: pre-line; }
  .modal-actions { display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end; }
  .modal-btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; font-size: 14px; font-weight: 600; }
  .modal-btn-cancel { background: var(--surface2); color: var(--text2); }
  .modal-btn-confirm { background: var(--accent); color: white; }
  .modal-btn-reject-confirm { background: var(--rejected); color: white; }

  .excel-btn { display: flex; align-items: center; gap: 8px; background: #1d6f42; border: 1px solid #2a9d5c; color: #6af7b8; border-radius: 10px; padding: 10px 18px; font-family: 'Noto Sans KR', sans-serif; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.15s; }
  .excel-btn:hover { background: #2a9d5c; transform: translateY(-1px); }

  .sign-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px,1fr)); gap: 16px; }
  .sign-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 16px; display: flex; flex-direction: column; align-items: center; gap: 10px; }
  .sign-card-label { font-size: 13px; font-weight: 700; color: var(--text); }
  .sign-preview { width: 120px; height: 60px; border: 1px dashed var(--border); border-radius: 8px; display: flex; align-items: center; justify-content: center; background: var(--surface2); overflow: hidden; }
  .sign-preview img { max-width: 100%; max-height: 100%; object-fit: contain; }
  .sign-preview-empty { font-size: 11px; color: var(--text3); }
  .sign-upload-btn { padding: 6px 14px; background: var(--surface2); border: 1px solid var(--border); color: var(--text2); border-radius: 8px; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; font-size: 12px; font-weight: 600; transition: all 0.15s; }
  .sign-upload-btn:hover { border-color: var(--accent); color: var(--accent); }
  .sign-delete-btn { background: none; border: none; color: var(--text3); font-size: 11px; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; padding: 2px 6px; }
  .sign-delete-btn:hover { color: var(--accent2); }

  @media (max-width: 900px) {
    .apply-layout { grid-template-columns: 1fr; }
    .section { padding: 20px; }
    .nav-tabs { padding: 16px 20px 0; overflow-x: auto; }
    .header { padding: 16px 20px; }
    .stat-numbers { grid-template-columns: repeat(2,1fr); }
  }
</style>
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<div class="header">
  <div class="header-logo">ğŸ“…</div>
  <h1>ì—°ì°¨ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
  <div class="header-right">
    <span class="header-date" id="currentDateDisplay"></span>
    <div id="adminStatus">
      <button class="admin-login-btn" onclick="openLoginModal()">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</button>
    </div>
  </div>
</div>

<div class="nav-tabs" id="navTabs">
  <button class="tab-btn active" onclick="switchTab(0)">ğŸ“† ì—°ì°¨ ì‹ ì²­</button>
  <button class="tab-btn" onclick="switchTab(1)">ğŸ“Š ì—°ì°¨ í˜„í™©</button>
</div>

<!-- SECTION 1 -->
<div class="section active" id="section-0">
  <div class="section-header">
    <div>
      <div class="section-title">ì—°ì°¨ ì‹ ì²­</div>
      <div class="section-desc">ìº˜ë¦°ë”ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•˜ê³  ì—°ì°¨ë¥¼ ì‹ ì²­í•˜ì„¸ìš”</div>
    </div>
  </div>
  <div class="apply-layout">
    <div class="calendar-wrap">
      <div class="cal-header">
        <div class="cal-nav">
          <button onclick="changeMonth(-1)">â€¹</button>
          <button onclick="changeMonth(1)">â€º</button>
        </div>
        <div>
          <span class="cal-month" id="calMonth"></span>
          <span class="cal-year" id="calYear"></span>
        </div>
        <button onclick="goToToday()" style="background:var(--surface2);border:1px solid var(--border);color:var(--text2);border-radius:6px;padding:4px 10px;cursor:pointer;font-size:12px;font-family:'Noto Sans KR',sans-serif;">ì˜¤ëŠ˜</button>
      </div>
      <div class="cal-grid">
        <div class="cal-days-header">
          <span>ì¼</span><span>ì›”</span><span>í™”</span><span>ìˆ˜</span><span>ëª©</span><span>ê¸ˆ</span><span>í† </span>
        </div>
        <div class="cal-cells" id="calCells"></div>
      </div>
      <div class="cal-legend">
        <div class="legend-item"><div class="legend-dot" style="background:var(--accent)"></div>ì„ íƒ</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--pending)"></div>ëŒ€ê¸°ì¤‘</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--approved)"></div>ìŠ¹ì¸</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--rejected)"></div>ë°˜ë ¤</div>
      </div>
    </div>
    <div class="apply-form">
      <div class="form-title">ì—°ì°¨ ì‹ ì²­ì„œ</div>
      <div class="form-group">
        <div class="form-label">ì§ì› ì„ íƒ</div>
        <select class="form-select" id="applyEmployee" onchange="updateRemainingInfo()">
          <option value="">ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”</option>
        </select>
      </div>
      <div class="form-group">
        <div class="form-label">ì‹ ì²­ ë‚ ì§œ (ìº˜ë¦°ë”ì—ì„œ í´ë¦­)</div>
        <div class="date-range-display" id="dateRangeDisplay">ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
      </div>
      <div class="form-group">
        <div class="form-label">ì—°ì°¨ ìœ í˜•</div>
        <div class="leave-type-grid">
          <button class="leave-type-btn active" onclick="selectLeaveType(this,'ì—°ì°¨')">ğŸŒ´ ì—°ì°¨</button>
          <button class="leave-type-btn" onclick="selectLeaveType(this,'ë°˜ì°¨(ì˜¤ì „)')">ğŸŒ… ë°˜ì°¨(ì˜¤ì „)</button>
          <button class="leave-type-btn" onclick="selectLeaveType(this,'ë°˜ì°¨(ì˜¤í›„)')">ğŸŒ‡ ë°˜ì°¨(ì˜¤í›„)</button>
          <button class="leave-type-btn" onclick="selectLeaveType(this,'ì¬ëŸ‰íœ´ê°€')">ğŸ‰ ì¬ëŸ‰íœ´ê°€</button>
          <button class="leave-type-btn" onclick="selectLeaveType(this,'ê³µê°€')">ğŸ›ï¸ ê³µê°€</button>
        </div>
      </div>
      <div class="form-group">
        <div class="form-label">ì‚¬ìœ </div>
        <input class="form-input" id="applyReason" placeholder="ì‹ ì²­ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
      </div>
      <div class="remaining-info" id="remainingInfo" style="display:none">
        <span id="remainingLabel">ì”ì—¬ ì—°ì°¨</span>
        <strong id="remainingDays">0ì¼</strong>
      </div>
      <button class="submit-btn" id="submitBtn" onclick="submitLeave()">ì—°ì°¨ ì‹ ì²­í•˜ê¸°</button>
    </div>
  </div>
</div>

<!-- SECTION 2 -->
<div class="section" id="section-1">
  <div class="section-header">
    <div>
      <div class="section-title">ì—°ì°¨ í˜„í™©</div>
      <div class="section-desc">ì§ì›ë³„ ì—°ì°¨ ë° ì¬ëŸ‰íœ´ê°€ ì‚¬ìš© í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”</div>
    </div>
    <button class="excel-btn" id="excelBtn" onclick="downloadExcel()" style="display:none">ğŸ“¥ íœ´ê°€ê³„ ë‹¤ìš´ë¡œë“œ</button>
  </div>
  <div class="stats-grid" id="statsGrid"></div>
  <div class="table-wrap">
    <div class="table-header">
      <div class="table-title">ì—°ì°¨ ì‹ ì²­ ë‚´ì—­</div>
      <select class="filter-select" id="historyFilter" onchange="renderHistory()">
        <option value="">ì „ì²´ ì§ì›</option>
      </select>
    </div>
    <table>
      <thead>
        <tr><th>ì§ì›</th><th>ìœ í˜•</th><th>ë‚ ì§œ</th><th>ì¼ìˆ˜</th><th>ì‚¬ìœ </th><th>ìƒíƒœ</th><th>ì‹ ì²­ì¼</th></tr>
      </thead>
      <tbody id="historyTable"></tbody>
    </table>
  </div>
</div>

<!-- SECTION 3 -->
<div class="section" id="section-2">
  <div class="section-header">
    <div>
      <div class="section-title">ìŠ¹ì¸ ê´€ë¦¬ <span style="font-size:14px;color:var(--accent);font-weight:500;">Â· ê´€ë¦¬ì ì „ìš©</span></div>
      <div class="section-desc">ëŒ€ê¸° ì¤‘ì¸ ì—°ì°¨ë¥¼ ìŠ¹ì¸í•˜ê±°ë‚˜ ë°˜ë ¤í•˜ì„¸ìš”. ì²˜ë¦¬ í›„ì—ëŠ” ìˆ˜ì •ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.</div>
    </div>
  </div>
  <div class="approval-grid" id="approvalGrid"></div>

  <!-- ì„œëª…/ë„ì¥ ê´€ë¦¬ -->
  <div style="margin-top:40px">
    <div class="section-header" style="margin-bottom:16px">
      <div>
        <div class="section-title" style="font-size:18px">âœï¸ ì„œëª… / ë„ì¥ ê´€ë¦¬</div>
        <div class="section-desc">íœ´ê°€ê³„ì— ìë™ìœ¼ë¡œ ì‚½ì…ë  ì„œëª…ê³¼ ë„ì¥ ì´ë¯¸ì§€ë¥¼ ë“±ë¡í•˜ì„¸ìš” (PNG/JPG ê¶Œì¥, ë°°ê²½ íˆ¬ëª…í•˜ë©´ ë” ê¹”ë”í•´ìš”)</div>
      </div>
    </div>
    <div class="sign-grid" id="signGrid"></div>
  </div>
</div>

<!-- LOGIN MODAL -->
<div class="login-overlay" id="loginOverlay">
  <div class="login-box">
    <div class="login-icon">ğŸ”</div>
    <h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
    <p>ìŠ¹ì¸ ê´€ë¦¬ ê¸°ëŠ¥ì€ ê´€ë¦¬ìë§Œ<br>ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    <input type="password" class="login-input" id="loginInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
      onkeydown="if(event.key==='Enter') doLogin()"
      oninput="document.getElementById('loginError').textContent=''" />
    <div class="login-error" id="loginError"></div>
    <button class="login-btn" onclick="doLogin()">ë¡œê·¸ì¸</button>
    <button class="login-cancel-btn" onclick="closeLoginModal()">ì·¨ì†Œ</button>
  </div>
</div>

<!-- CONFIRM MODAL -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h3 id="modalTitle"></h3>
    <p id="modalDesc"></p>
    <div class="modal-actions">
      <button class="modal-btn modal-btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
      <button class="modal-btn" id="modalConfirmBtn" onclick="modalConfirm()"></button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <span id="toastIcon"></span>
  <span id="toastMsg"></span>
</div>

<script>
  // ====== Firebase ì´ˆê¸°í™” ======
  const firebaseConfig = {
    apiKey: "AIzaSyA279nTvQk6J_wNC1AIUT07IgwQOa6J7Zo",
    authDomain: "y-3aece.firebaseapp.com",
    projectId: "y-3aece",
    storageBucket: "y-3aece.firebasestorage.app",
    messagingSenderId: "682772417884",
    appId: "1:682772417884:web:f2cf3b6386dbc01c2a8599"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ====== ìƒìˆ˜ ======
  const ADMIN_PW = '080525';
  const MONTHS = ['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
  const EMPLOYEES = [
    { name: 'ì„œí›ˆ',   total: 15, discretionary: 5, color: '#7c6af7' },
    { name: 'ë°•ë¯¸í™”', total: 25, discretionary: 5, color: '#f76a8a' },
    { name: 'ê¹€í˜¸ë¯¼', total: 24, discretionary: 5, color: '#6af7b8' },
    { name: 'ì´ì¶˜ì¬', total: 18, discretionary: 5, color: '#f7c76a' },
    { name: 'ë°±ì¸ì„±', total: 19, discretionary: 5, color: '#6ab4f7' },
    { name: 'ê¶Œë¯¼ì •', total: 20, discretionary: 5, color: '#f7a06a' },
    { name: 'ê¹€ì†Œì •', total: 19, discretionary: 5, color: '#a06af7' },
  ];
  const EMP_MAP = {};
  EMPLOYEES.forEach(e => { EMP_MAP[e.name] = e; });

  // ====== ìƒíƒœ ======
  let leaves = [];
  let isAdmin = false;
  let calDate = new Date();
  let selectedDate = null;
  let selectedLeaveType = 'ì—°ì°¨';
  let currentTab = 0;
  let pendingAction = null;

  // ====== ì´ˆê¸°í™” ======
  function init() {
    document.getElementById('currentDateDisplay').textContent =
      new Date().toLocaleDateString('ko-KR', {year:'numeric',month:'long',day:'numeric',weekday:'long'});

    EMPLOYEES.forEach(e => {
      document.getElementById('applyEmployee').innerHTML += '<option value="'+e.name+'">'+e.name+'</option>';
      document.getElementById('historyFilter').innerHTML += '<option value="'+e.name+'">'+e.name+'</option>';
    });

    renderCalendar();
    loadSignatures();

    // Firestore ì‹¤ì‹œê°„ ì—°ë™
    db.collection('leaves').orderBy('appliedAt', 'desc').onSnapshot(function(snapshot) {
      leaves = snapshot.docs.map(function(doc) {
        return Object.assign({}, doc.data(), { firestoreId: doc.id });
      });
      renderCalendar();
      if (currentTab === 1) { renderStats(); renderHistory(); }
      if (currentTab === 2) renderApprovals();
      document.getElementById('loadingOverlay').classList.add('hide');
    }, function(error) {
      console.error('Firestore ì˜¤ë¥˜:', error);
      document.getElementById('loadingOverlay').classList.add('hide');
      showToast('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.', 'error');
    });
  }

  // ====== ê´€ë¦¬ì ======
  function openLoginModal() {
    document.getElementById('loginInput').value = '';
    document.getElementById('loginError').textContent = '';
    document.getElementById('loginOverlay').classList.add('show');
    setTimeout(function() { document.getElementById('loginInput').focus(); }, 200);
  }
  function closeLoginModal() { document.getElementById('loginOverlay').classList.remove('show'); }

  function doLogin() {
    var pw = document.getElementById('loginInput').value;
    if (pw === ADMIN_PW) {
      isAdmin = true;
      closeLoginModal();
      updateAdminUI();
      showToast('ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
      switchTab(2);
    } else {
      var input = document.getElementById('loginInput');
      document.getElementById('loginError').textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
      input.classList.add('error');
      input.value = '';
      setTimeout(function() { input.classList.remove('error'); }, 400);
    }
  }

  function doLogout() {
    isAdmin = false;
    updateAdminUI();
    switchTab(0);
    showToast('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
  }

  function updateAdminUI() {
    var statusEl = document.getElementById('adminStatus');
    var navTabs = document.getElementById('navTabs');
    var excelBtn = document.getElementById('excelBtn');
    if (isAdmin) {
      statusEl.innerHTML = '<div style="display:flex;align-items:center;gap:8px"><div class="admin-badge">ğŸ›¡ï¸ ê´€ë¦¬ì ëª¨ë“œ</div><button class="admin-logout-btn" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button></div>';
      if (excelBtn) excelBtn.style.display = 'flex';
      if (!document.getElementById('adminTab')) {
        var btn = document.createElement('button');
        btn.className = 'tab-btn admin-tab'; btn.id = 'adminTab';
        btn.innerHTML = 'âœ… ìŠ¹ì¸ ê´€ë¦¬';
        btn.onclick = function() { switchTab(2); };
        navTabs.appendChild(btn);
      }
    } else {
      statusEl.innerHTML = '<button class="admin-login-btn" onclick="openLoginModal()">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</button>';
      if (excelBtn) excelBtn.style.display = 'none';
      var adminTab = document.getElementById('adminTab');
      if (adminTab) adminTab.remove();
    }
  }

  // ====== íƒ­ ======
  function switchTab(idx) {
    if (idx === 2 && !isAdmin) { openLoginModal(); return; }
    currentTab = idx;
    document.querySelectorAll('.tab-btn').forEach(function(btn, i) { btn.classList.toggle('active', i === idx); });
    document.querySelectorAll('.section').forEach(function(sec, i) { sec.classList.toggle('active', i === idx); });
    if (idx === 1) { renderStats(); renderHistory(); }
    if (idx === 2) { renderApprovals(); renderSignGrid(); }
  }

  // ====== ìº˜ë¦°ë” ======
  function changeMonth(dir) { calDate.setMonth(calDate.getMonth() + dir); renderCalendar(); }
  function goToToday() { calDate = new Date(); renderCalendar(); }

  function renderCalendar() {
    var year = calDate.getFullYear(), month = calDate.getMonth();
    document.getElementById('calMonth').textContent = MONTHS[month];
    document.getElementById('calYear').textContent = year + 'ë…„';
    var firstDay = new Date(year, month, 1).getDay();
    var daysInMonth = new Date(year, month+1, 0).getDate();
    var today = new Date();
    var container = document.getElementById('calCells');
    container.innerHTML = '';

    for (var i = 0; i < firstDay; i++) {
      var empty = document.createElement('div');
      empty.className = 'cal-cell empty';
      container.appendChild(empty);
    }
    for (var d = 1; d <= daysInMonth; d++) {
      (function(d) {
        var date = new Date(year, month, d);
        var dow = date.getDay();
        var cell = document.createElement('div');
        cell.className = 'cal-cell';
        if (dow === 0) cell.classList.add('sunday');
        if (dow === 6) cell.classList.add('saturday');
        if (today.getFullYear()===year && today.getMonth()===month && today.getDate()===d) cell.classList.add('today');
        if (selectedDate && selectedDate.toDateString()===date.toDateString()) cell.classList.add('selected');

        var numSpan = document.createElement('span');
        numSpan.textContent = d;
        cell.appendChild(numSpan);

        var dateStr = formatDate(date);
        var dayLeaves = leaves.filter(function(l) { return l.startDate === dateStr; });
        if (dayLeaves.length > 0) {
          var dots = document.createElement('div');
          dots.className = 'leave-dots';
          dayLeaves.slice(0,3).forEach(function(l) {
            var dot = document.createElement('div');
            dot.className = 'leave-dot';
            dot.style.background = l.status==='approved'?'var(--approved)':l.status==='rejected'?'var(--rejected)':'var(--pending)';
            dots.appendChild(dot);
          });
          cell.appendChild(dots);
        }
        cell.onclick = function() { handleDateClick(date); };
        container.appendChild(cell);
      })(d);
    }
  }

  function handleDateClick(date) {
    selectedDate = date;
    updateDateDisplay();
    renderCalendar();
  }

  function updateDateDisplay() {
    var el = document.getElementById('dateRangeDisplay');
    if (!selectedDate) { el.textContent = 'ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'; el.classList.remove('filled'); return; }
    el.classList.add('filled');
    var dayCount = selectedLeaveType.includes('ë°˜ì°¨') ? 0.5 : 1;
    el.textContent = formatDate(selectedDate) + ' (' + dayCount + 'ì¼)';
  }

  function formatDate(date) {
    return date.getFullYear() + '-' + String(date.getMonth()+1).padStart(2,'0') + '-' + String(date.getDate()).padStart(2,'0');
  }

  function selectLeaveType(btn, type) {
    document.querySelectorAll('.leave-type-btn').forEach(function(b) { b.classList.remove('active'); });
    btn.classList.add('active');
    selectedLeaveType = type;
    var empName = document.getElementById('applyEmployee').value;
    if (empName) updateRemainingInfo();
    updateDateDisplay();
  }

  function updateRemainingInfo() {
    var name = document.getElementById('applyEmployee').value;
    var el = document.getElementById('remainingInfo');
    if (!name) { el.style.display = 'none'; return; }
    el.style.display = 'flex';
    var emp = EMP_MAP[name];
    if (selectedLeaveType === 'ì¬ëŸ‰íœ´ê°€') {
      document.getElementById('remainingLabel').textContent = 'ì”ì—¬ ì¬ëŸ‰íœ´ê°€';
      document.getElementById('remainingDays').textContent = (emp.discretionary - getUsedDiscretionary(name)) + 'ì¼';
    } else {
      document.getElementById('remainingLabel').textContent = 'ì”ì—¬ ì—°ì°¨';
      document.getElementById('remainingDays').textContent = (emp.total - getUsedLeave(name)) + 'ì¼';
    }
  }

  function getUsedLeave(name) {
    return leaves.filter(function(l) { return l.employee===name && l.status!=='rejected' && l.type!=='ì¬ëŸ‰íœ´ê°€'; })
      .reduce(function(sum,l) { return sum+l.days; }, 0);
  }
  function getUsedDiscretionary(name) {
    return leaves.filter(function(l) { return l.employee===name && l.status!=='rejected' && l.type==='ì¬ëŸ‰íœ´ê°€'; })
      .reduce(function(sum,l) { return sum+l.days; }, 0);
  }

  // ====== ì—°ì°¨ ì‹ ì²­ ======
  function submitLeave() {
    var name = document.getElementById('applyEmployee').value;
    var reason = document.getElementById('applyReason').value;
    if (!name) { showToast('ì§ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error'); return; }
    if (!selectedDate) { showToast('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error'); return; }

    var days = selectedLeaveType.includes('ë°˜ì°¨') ? 0.5 : 1;
    var emp = EMP_MAP[name];

    if (selectedLeaveType === 'ì¬ëŸ‰íœ´ê°€') {
      var remainingD = emp.discretionary - getUsedDiscretionary(name);
      if (days > remainingD) { showToast('ì¬ëŸ‰íœ´ê°€ ì”ì—¬ì¼ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ì”ì—¬: ' + remainingD + 'ì¼)', 'error'); return; }
    } else if (selectedLeaveType !== 'ê³µê°€') {
      var remainingL = emp.total - getUsedLeave(name);
      if (days > remainingL) { showToast('ì”ì—¬ ì—°ì°¨ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (ì”ì—¬: ' + remainingL + 'ì¼)', 'error'); return; }
    }

    var btn = document.getElementById('submitBtn');
    btn.disabled = true;
    btn.textContent = 'ì‹ ì²­ ì¤‘...';

    db.collection('leaves').add({
      employee: name,
      type: selectedLeaveType,
      startDate: formatDate(selectedDate),
      endDate: formatDate(selectedDate),
      days: days,
      reason: reason || 'ë¯¸ê¸°ì¬',
      status: 'pending',
      appliedAt: formatDate(new Date())
    }).then(function() {
      showToast(name + 'ë‹˜ì˜ ' + selectedLeaveType + ' ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
      selectedDate = null;
      document.getElementById('applyReason').value = '';
      updateDateDisplay();
      updateRemainingInfo();
      btn.disabled = false;
      btn.textContent = 'ì—°ì°¨ ì‹ ì²­í•˜ê¸°';
    }).catch(function(e) {
      console.error(e);
      showToast('ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      btn.disabled = false;
      btn.textContent = 'ì—°ì°¨ ì‹ ì²­í•˜ê¸°';
    });
  }

  // ====== í˜„í™© ======
  function renderStats() {
    var grid = document.getElementById('statsGrid');
    grid.innerHTML = '';
    EMPLOYEES.forEach(function(emp) {
      var usedLeave = getUsedLeave(emp.name);
      var usedDisc = getUsedDiscretionary(emp.name);
      var remainLeave = emp.total - usedLeave;
      var leavePct = Math.min((usedLeave / emp.total) * 100, 100);
      var discPct = Math.min((usedDisc / emp.discretionary) * 100, 100);
      grid.innerHTML += '<div class="stat-card">' +
        '<div class="stat-card-header"><div><div class="employee-name">'+emp.name+'</div></div><div class="employee-avatar" style="background:'+emp.color+'">'+emp.name[0]+'</div></div>' +
        '<div class="stat-bars">' +
          '<div class="stat-row"><div class="stat-row-header"><span>ì—°ì°¨ ì‚¬ìš©ë¥ </span><span>'+usedLeave+'/'+emp.total+'ì¼</span></div><div class="stat-bar-bg"><div class="stat-bar-fill" style="width:'+leavePct+'%;background:'+emp.color+'"></div></div></div>' +
          '<div class="stat-row"><div class="stat-row-header"><span>ì¬ëŸ‰íœ´ê°€ ì‚¬ìš©ë¥ </span><span>'+usedDisc+'/'+emp.discretionary+'ì¼</span></div><div class="stat-bar-bg"><div class="stat-bar-fill" style="width:'+discPct+'%;background:var(--accent4)"></div></div></div>' +
        '</div>' +
        '<div class="stat-numbers">' +
          '<div class="stat-num"><div class="stat-num-val" style="color:'+emp.color+'">'+emp.total+'</div><div class="stat-num-label">ì´ ì—°ì°¨</div></div>' +
          '<div class="stat-num"><div class="stat-num-val" style="color:var(--accent4)">'+emp.discretionary+'</div><div class="stat-num-label">ì¬ëŸ‰íœ´ê°€</div></div>' +
          '<div class="stat-num"><div class="stat-num-val" style="color:var(--accent2)">'+usedLeave+'</div><div class="stat-num-label">ì‚¬ìš© ì—°ì°¨</div></div>' +
          '<div class="stat-num"><div class="stat-num-val" style="color:var(--accent3)">'+remainLeave+'</div><div class="stat-num-label">ì”ì—¬ ì—°ì°¨</div></div>' +
        '</div></div>';
    });
  }

  function renderHistory() {
    var filter = document.getElementById('historyFilter').value;
    var tbody = document.getElementById('historyTable');
    var filtered = leaves.filter(function(l) { return !filter || l.employee===filter; });
    if (filtered.length === 0) {
      tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:var(--text3);padding:40px">ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
      return;
    }
    tbody.innerHTML = filtered.map(function(l) {
      return '<tr><td><strong>'+l.employee+'</strong></td><td>'+l.type+'</td>' +
        '<td style="font-family:\'DM Mono\',monospace;font-size:12px">'+l.startDate+'</td>' +
        '<td><strong>'+l.days+'ì¼</strong></td>' +
        '<td style="color:var(--text2)">'+l.reason+'</td>' +
        '<td><span class="badge badge-'+l.status+'">'+(l.status==='approved'?'ìŠ¹ì¸':l.status==='rejected'?'ë°˜ë ¤':'ëŒ€ê¸°ì¤‘')+'</span></td>' +
        '<td style="color:var(--text3);font-size:12px">'+l.appliedAt+'</td></tr>';
    }).join('');
  }

  // ====== ìŠ¹ì¸ ê´€ë¦¬ ======
  function renderApprovals() {
    var grid = document.getElementById('approvalGrid');
    if (leaves.length === 0) {
      grid.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“­</div><p>ì—°ì°¨ ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
      return;
    }
    var sorted = leaves.slice().sort(function(a,b) {
      var order = {pending:0,approved:1,rejected:2};
      return order[a.status] - order[b.status];
    });
    grid.innerHTML = sorted.map(function(l) {
      var emp = EMP_MAP[l.employee];
      var isPending = l.status==='pending';
      var statusLabel = l.status==='approved'
        ? '<span style="color:var(--approved);font-size:13px;font-weight:700">âœ… ìŠ¹ì¸ì™„ë£Œ</span>'
        : l.status==='rejected'
        ? '<span style="color:var(--rejected);font-size:13px;font-weight:700">âŒ ë°˜ë ¤</span>' : '';
      var actions = isPending
        ? '<button class="btn-approve" onclick="openApprovalModal(\'approve\',\''+l.firestoreId+'\')">âœ“ ìŠ¹ì¸</button><button class="btn-reject" onclick="openApprovalModal(\'reject\',\''+l.firestoreId+'\')">âœ— ë°˜ë ¤</button>'
        : '<div class="btn-locked">ğŸ”’ ì²˜ë¦¬ì™„ë£Œ</div>';
      return '<div class="approval-card '+l.status+'">' +
        '<div class="approval-avatar" style="background:'+emp.color+'">'+l.employee[0]+'</div>' +
        '<div class="approval-info">' +
          '<div class="approval-name">'+l.employee+' Â· <span style="font-weight:400;font-size:13px">'+l.type+'</span></div>' +
          '<div class="approval-detail">'+l.days+'ì¼ Â· '+l.reason+'</div>' +
          '<div class="approval-dates">'+l.startDate+'</div>' +
        '</div>' +
        statusLabel +
        '<div class="approval-actions">'+actions+'</div>' +
      '</div>';
    }).join('');
  }

  // ====== ëª¨ë‹¬ ======
  function openApprovalModal(action, firestoreId) {
    var leave = leaves.find(function(l) { return l.firestoreId===firestoreId; });
    pendingAction = { action: action, firestoreId: firestoreId };
    var confirmBtn = document.getElementById('modalConfirmBtn');
    if (action==='approve') {
      document.getElementById('modalTitle').textContent = 'ì—°ì°¨ ìŠ¹ì¸';
      document.getElementById('modalDesc').textContent = leave.employee+'ë‹˜ì˜ '+leave.type+' ì‹ ì²­ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në‚ ì§œ: '+leave.startDate+' ('+leave.days+'ì¼)\n\nìŠ¹ì¸ í›„ì—ëŠ” ìˆ˜ì •ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.';
      confirmBtn.textContent = 'ìŠ¹ì¸í•˜ê¸°'; confirmBtn.className = 'modal-btn modal-btn-confirm';
    } else {
      document.getElementById('modalTitle').textContent = 'ì—°ì°¨ ë°˜ë ¤';
      document.getElementById('modalDesc').textContent = leave.employee+'ë‹˜ì˜ '+leave.type+' ì‹ ì²­ì„ ë°˜ë ¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në°˜ë ¤ í›„ì—ëŠ” ìˆ˜ì •ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.';
      confirmBtn.textContent = 'ë°˜ë ¤í•˜ê¸°'; confirmBtn.className = 'modal-btn modal-btn-reject-confirm';
    }
    document.getElementById('modalOverlay').classList.add('show');
  }

  function closeModal() { document.getElementById('modalOverlay').classList.remove('show'); pendingAction = null; }

  function modalConfirm() {
    if (!pendingAction) return;
    var action = pendingAction.action, firestoreId = pendingAction.firestoreId;
    var leave = leaves.find(function(l) { return l.firestoreId===firestoreId; });
    closeModal();
    db.collection('leaves').doc(firestoreId).update({
      status: action==='approve' ? 'approved' : 'rejected'
    }).then(function() {
      showToast(leave.employee+'ë‹˜ì˜ '+leave.type+'ì´ '+(action==='approve'?'ìŠ¹ì¸':'ë°˜ë ¤')+'ë˜ì—ˆìŠµë‹ˆë‹¤.', action==='approve'?'success':'error');
    }).catch(function() {
      showToast('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
    });
  }

  document.getElementById('modalOverlay').onclick = function(e) { if(e.target===this) closeModal(); };
  document.getElementById('loginOverlay').onclick = function(e) { if(e.target===this) closeLoginModal(); };

  // ====== ì„œëª…/ë„ì¥ ê´€ë¦¬ ======
  // ì„œëª… í‚¤ ëª©ë¡: ì§ì› 7ëª… + ë‹´ë‹¹ì ë„ì¥ 1ê°œ
  var SIGN_KEYS = [
    {key:'stamp_manager', label:'ğŸ“Œ ë‹´ë‹¹ì ë„ì¥ (ê²°ì¬ë€)'},
  ];
  EMPLOYEES.forEach(function(e){
    SIGN_KEYS.push({key:'sign_'+e.name, label:'âœï¸ '+e.name+' ì„œëª…'});
  });

  var signImages = {}; // key â†’ base64 dataURL

  function renderSignGrid() {
    var grid = document.getElementById('signGrid');
    if (!grid) return;
    grid.innerHTML = '';
    SIGN_KEYS.forEach(function(item) {
      var img = signImages[item.key];
      var previewHtml = img
        ? '<img src="' + img + '" />'
        : '<span class="sign-preview-empty">ë¯¸ë“±ë¡</span>';
      var deleteBtn = img
        ? '<button class="sign-delete-btn" onclick="deleteSign(\'' + item.key + '\')">ğŸ—‘ï¸ ì‚­ì œ</button>'
        : '';
      grid.innerHTML += '<div class="sign-card">' +
        '<div class="sign-card-label">' + item.label + '</div>' +
        '<div class="sign-preview" id="prev_' + item.key + '">' + previewHtml + '</div>' +
        '<label class="sign-upload-btn">ğŸ“ ì´ë¯¸ì§€ ë“±ë¡' +
          '<input type="file" accept="image/*" style="display:none" onchange="uploadSign(event,\'' + item.key + '\')" />' +
        '</label>' +
        '<span id="del_' + item.key + '">' + deleteBtn + '</span>' +
      '</div>';
    });
  }

  function uploadSign(event, key) {
    var file = event.target.files[0];
    if (!file) return;
    var reader = new FileReader();
    reader.onload = function(e) {
      var dataUrl = e.target.result;
      signImages[key] = dataUrl;
      // Firebaseì— ì €ì¥
      db.collection('signatures').doc(key).set({dataUrl: dataUrl})
        .then(function(){ showToast('ì„œëª…ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success'); renderSignGrid(); })
        .catch(function(){ showToast('ì €ì¥ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error'); });
    };
    reader.readAsDataURL(file);
  }

  function deleteSign(key) {
    db.collection('signatures').doc(key).delete()
      .then(function(){
        delete signImages[key];
        showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        renderSignGrid();
      });
  }

  function loadSignatures() {
    db.collection('signatures').get().then(function(snapshot) {
      snapshot.forEach(function(doc) {
        signImages[doc.id] = doc.data().dataUrl;
      });
    });
  }

  // ====== íœ´ê°€ê³„ ë‹¤ìš´ë¡œë“œ ======
  function makeVacationSheet(wb, leave) {
    var emp = EMP_MAP[leave.employee];
    var usedLeave = getUsedLeave(leave.employee);
    var remaining = emp.total - usedLeave;

    var ws = {};
    var tk = {style:'medium'}, tn = {style:'thin'}, no = {};

    function sc(addr, v, s) { ws[addr] = {v:v, t:'s', s:s}; }
    function bdr(t,b,l,r){ return {top:t||no,bottom:b||no,left:l||no,right:r||no}; }
    function ft(bold,sz){ return {name:'ë§‘ì€ ê³ ë”•',sz:sz||10,bold:!!bold}; }
    function al(hz,vt,wrap){ return {horizontal:hz||'center',vertical:vt||'center',wrapText:!!wrap}; }

    // â”€â”€ ì œëª© B3:K3 â”€â”€
    sc('B3','íœ´  ê°€  ê³„',{font:ft(true,22),alignment:al(),border:bdr(tk,no,tk,no)});
    ['C3','D3','E3','F3','G3','H3','I3'].forEach(function(a){ws[a]={v:'',t:'s',s:{border:bdr(tk,no,no,no)}};});
    ws['J3']={v:'',t:'s',s:{border:bdr(tk,no,no,no)}};
    ws['K3']={v:'',t:'s',s:{border:bdr(tk,no,no,tk)}};

    // 4í–‰
    sc('B4','',{border:bdr(no,tn,tk,no)});
    ['C4','D4','E4','F4','G4','H4','I4'].forEach(function(a){ws[a]={v:'',t:'s',s:{border:bdr(no,tn,no,no)}};});
    ws['J4']={v:'',t:'s',s:{border:bdr(no,tn,no,tk)}};
    ws['K4']={v:'',t:'s',s:{border:bdr(no,tn,no,tk)}};

    // 5~7í–‰ ê²°ì¬ë€
    ws['B5']={v:'',t:'s',s:{border:bdr(no,no,tk,no)}};
    sc('J5','ê²°\nì¬',{font:ft(true,10),alignment:al('center','center',true),border:bdr(tn,tn,tn,tn)});
    sc('K5','ë‹´  ë‹¹',{font:ft(true,9),alignment:al(),border:bdr(tn,tn,tn,tk)});
    ws['B6']={v:'',t:'s',s:{border:bdr(no,no,tk,no)}};
    ws['J6']={v:'',t:'s',s:{border:bdr(no,no,tn,tn)}};
    ws['K6']={v:'',t:'s',s:{border:bdr(tn,tn,tn,tk)}};
    ws['B7']={v:'',t:'s',s:{border:bdr(no,no,tk,no)}};
    ws['J7']={v:'',t:'s',s:{border:bdr(no,tn,tn,tn)}};
    ws['K7']={v:'',t:'s',s:{border:bdr(no,tn,tn,tk)}};

    // 8í–‰
    sc('B8','',{border:bdr(no,tn,tk,no)});
    ['C8','D8','E8','F8','G8','H8','I8'].forEach(function(a){ws[a]={v:'',t:'s',s:{border:bdr(no,tn,no,no)}};});
    ws['J8']={v:'',t:'s',s:{border:bdr(tn,tn,no,tk)}};
    ws['K8']={v:'',t:'s',s:{border:bdr(tn,tn,no,tk)}};

    // 9í–‰ ì„±ëª…/ë¶€ì„œ
    sc('B9','ì„±       ëª…',{font:ft(true,9),alignment:al(),border:bdr(tn,tn,tk,tn)});
    ws['C9']={v:'',t:'s',s:{border:bdr(tn,tn,no,tn)}};
    sc('D9',leave.employee,{font:ft(false,10),alignment:al(),border:bdr(tn,tn,tn,tn)});
    ws['E9']={v:'',t:'s',s:{border:bdr(tn,tn,no,no)}};
    ws['F9']={v:'',t:'s',s:{border:bdr(tn,tn,no,tn)}};
    sc('G9','ë¶€       ì„œ',{font:ft(true,9),alignment:al(),border:bdr(tn,tn,tn,tn)});
    ws['H9']={v:'',t:'s',s:{border:bdr(tn,tn,no,no)}};
    ws['I9']={v:'',t:'s',s:{border:bdr(tn,tn,no,tn)}};
    ws['J9']={v:'',t:'s',s:{border:bdr(tn,tn,tn,no)}};
    ws['K9']={v:'',t:'s',s:{border:bdr(tn,tn,no,tk)}};

    // 10í–‰ ì”ì—¬ì¼/ì‹ ì²­ì¼
    sc('B10','ì—°ì°¨ ì”ì—¬ì¼ìˆ˜',{font:ft(true,9),alignment:al(),border:bdr(tn,tn,tk,tn)});
    ws['C10']={v:'',t:'s',s:{border:bdr(tn,tn,no,tn)}};
    sc('D10',remaining+'ì¼',{font:ft(false,10),alignment:al(),border:bdr(tn,tn,tn,tn)});
    ws['E10']={v:'',t:'s',s:{border:bdr(tn,tn,no,no)}};
    ws['F10']={v:'',t:'s',s:{border:bdr(tn,tn,no,tn)}};
    sc('G10','ì‹   ì²­  ì¼',{font:ft(true,9),alignment:al(),border:bdr(tn,tn,tn,tn)});
    ws['H10']={v:'',t:'s',s:{border:bdr(tn,tn,no,no)}};
    ws['I10']={v:'',t:'s',s:{border:bdr(tn,tn,no,tn)}};
    ws['J10']={v:'',t:'s',s:{border:bdr(tn,tn,tn,no)}};
    ws['K10']={v:'',t:'s',s:{border:bdr(tn,tn,no,tk)}};
    sc('G10',leave.appliedAt,{font:ft(false,9),alignment:al(),border:bdr(tn,tn,tn,tn)});

    // 11í–‰ êµ¬ë¶„
    var types=['ì—°ì°¨','ë°˜ì°¨(ì˜¤ì „)','ë°˜ì°¨(ì˜¤í›„)','ì¬ëŸ‰íœ´ê°€','ê³µê°€'];
    var tStr=types.map(function(t){return (t===leave.type?'â˜‘':'â–¡')+' '+t;});
    sc('B11','íœ´ ê°€  êµ¬ ë¶„',{font:ft(true,9),alignment:al(),border:bdr(tn,tn,tk,tn)});
    ws['C11']={v:'',t:'s',s:{border:bdr(tn,tn,no,tn)}};
    sc('D11',tStr.slice(0,3).join('     ')+'\n'+tStr.slice(3).join('     '),
      {font:ft(false,9),alignment:al('left','center',true),border:bdr(tn,tn,tn,tn)});
    ['E11','F11','G11','H11','I11','J11'].forEach(function(a){ws[a]={v:'',t:'s',s:{border:bdr(tn,tn,no,no)}};});
    ws['K11']={v:'',t:'s',s:{border:bdr(tn,tn,no,tk)}};

    // 12í–‰ ê¸°ê°„
    sc('B12','íœ´ ê°€  ê¸° ê°„',{font:ft(true,9),alignment:al(),border:bdr(tn,tn,tk,tn)});
    ws['C12']={v:'',t:'s',s:{border:bdr(tn,tn,no,tn)}};
    sc('D12',leave.startDate,{font:ft(false,10),alignment:al(),border:bdr(tn,tn,tn,tn)});
    ['E12','F12','G12','H12'].forEach(function(a){ws[a]={v:'',t:'s',s:{border:bdr(tn,tn,no,no)}};});
    ws['H12']={v:'',t:'s',s:{border:bdr(tn,tn,no,tn)}};
    sc('I12','ì¼  ìˆ˜',{font:ft(true,9),alignment:al(),border:bdr(tn,tn,tn,tn)});
    ws['J12']={v:'',t:'s',s:{border:bdr(tn,tn,tn,no)}};
    ws['K12']={v:'',t:'s',s:{border:bdr(tn,tn,no,tk)}};
    sc('J12',leave.days+'ì¼',{font:ft(false,10),alignment:al(),border:bdr(tn,tn,tn,no)});

    // 13í–‰ ì‚¬ìœ 
    sc('B13','íœ´ ê°€  ì‚¬ ìœ ',{font:ft(true,9),alignment:al(),border:bdr(tn,tn,tk,tn)});
    ws['C13']={v:'',t:'s',s:{border:bdr(tn,tn,no,tn)}};
    sc('D13',leave.reason,{font:ft(false,10),alignment:al('left','center',true),border:bdr(tn,tn,tn,tn)});
    ['E13','F13','G13','H13','I13','J13'].forEach(function(a){ws[a]={v:'',t:'s',s:{border:bdr(tn,tn,no,no)}};});
    ws['K13']={v:'',t:'s',s:{border:bdr(tn,tn,no,tk)}};

    // 14í–‰
    sc('B14','',{border:bdr(tn,no,tk,tk)});
    ['C14','D14','E14','F14','G14','H14','I14','J14'].forEach(function(a){ws[a]={v:'',t:'s',s:{border:bdr(tn,no,no,no)}};});
    ws['K14']={v:'',t:'s',s:{border:bdr(tn,no,no,tk)}};

    // 15í–‰ í•˜ë‹¨ë¬¸êµ¬
    sc('B15','ìœ„ì™€ ê°™ì´ íœ´ê°€ë¥¼ ì‹ ì²­í•˜ì˜¤ë‹ˆ í—ˆë½í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.',
      {font:ft(false,10),alignment:al(),border:bdr(no,no,tk,tk)});
    ['C15','D15','E15','F15','G15','H15','I15','J15'].forEach(function(a){ws[a]={v:'',t:'s',s:{border:bdr(no,no,no,no)}};});
    ws['K15']={v:'',t:'s',s:{border:bdr(no,no,no,tk)}};

    // 16~18í–‰ ì‹ ì²­ì¸/ì„œëª…ë€
    ws['B16']={v:'',t:'s',s:{border:bdr(no,no,tk,no)}};
    ws['B17']={v:'',t:'s',s:{border:bdr(no,no,tk,no)}};
    ws['B18']={v:'',t:'s',s:{border:bdr(no,no,tk,no)}};
    // F16:G18 ì‹ ì²­ì¸ ë¼ë²¨
    sc('F16','ì‹ ì²­ì¸',{font:ft(true,9),alignment:al('center','center'),border:bdr(no,no,no,no)});
    ws['G16']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    ws['F17']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    ws['G17']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    ws['F18']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    ws['G18']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    // H16:J18 ì‹ ì²­ì ì´ë¦„
    sc('H16',leave.employee,{font:ft(false,10),alignment:al('center','center'),border:bdr(no,no,no,no)});
    ws['I16']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    ws['J16']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    ws['H17']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    ws['I17']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    ws['J17']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    ws['H18']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    ws['I18']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    ws['J18']={v:'',t:'s',s:{border:bdr(no,no,no,no)}};
    // K16:K18 ì„œëª… ì¹¸
    ws['K16']={v:'',t:'s',s:{border:bdr(no,no,no,tk)}};
    ws['K17']={v:'',t:'s',s:{border:bdr(no,no,no,tk)}};
    ws['K18']={v:'',t:'s',s:{border:bdr(no,no,no,tk)}};

    // 19í–‰ íšŒì‚¬ëª…
    sc('B19','(ì£¼) ì„ í™”',{font:ft(false,10),alignment:al('left','center'),border:bdr(no,tk,tk,tk)});
    ['C19','D19','E19','F19','G19','H19','I19','J19'].forEach(function(a){ws[a]={v:'',t:'s',s:{border:bdr(no,tk,no,no)}};});
    ws['K19']={v:'',t:'s',s:{border:bdr(no,tk,no,tk)}};

    // ë³‘í•© ì…€ (ì–‘ì‹ ê·¸ëŒ€ë¡œ)
    ws['!merges'] = [
      {s:{r:2,c:1},e:{r:2,c:10}},   // B3:K3 ì œëª©
      {s:{r:3,c:1},e:{r:7,c:8}},    // B4:I8 ê²°ì¬ë€ ê³µê°„
      {s:{r:4,c:9},e:{r:6,c:9}},    // J5:J7 ê²°ì¬
      {s:{r:3,c:9},e:{r:3,c:10}},   // J4:K4
      {s:{r:5,c:10},e:{r:6,c:10}},  // K6:K7 ë‹´ë‹¹ì ì„œëª…
      {s:{r:7,c:9},e:{r:7,c:10}},   // J8:K8
      {s:{r:8,c:1},e:{r:8,c:2}},    // B9:C9
      {s:{r:8,c:3},e:{r:8,c:5}},    // D9:F9
      {s:{r:8,c:6},e:{r:8,c:8}},    // G9:I9
      {s:{r:8,c:9},e:{r:8,c:10}},   // J9:K9
      {s:{r:9,c:1},e:{r:9,c:2}},    // B10:C10
      {s:{r:9,c:3},e:{r:9,c:5}},    // D10:F10
      {s:{r:9,c:6},e:{r:9,c:8}},    // G10:I10
      {s:{r:9,c:9},e:{r:9,c:10}},   // J10:K10
      {s:{r:10,c:1},e:{r:10,c:2}},  // B11:C11
      {s:{r:10,c:3},e:{r:10,c:10}}, // D11:K11
      {s:{r:11,c:1},e:{r:11,c:2}},  // B12:C12
      {s:{r:11,c:3},e:{r:11,c:7}},  // D12:H12
      {s:{r:11,c:9},e:{r:11,c:10}}, // J12:K12
      {s:{r:12,c:1},e:{r:12,c:2}},  // B13:C13
      {s:{r:12,c:3},e:{r:12,c:10}}, // D13:K13
      {s:{r:13,c:1},e:{r:13,c:10}}, // B14:K14
      {s:{r:14,c:1},e:{r:14,c:10}}, // B15:K15
      {s:{r:15,c:5},e:{r:17,c:6}},  // F16:G18 ì‹ ì²­ì¸ë¼ë²¨
      {s:{r:15,c:7},e:{r:17,c:9}},  // H16:J18 ì´ë¦„
      {s:{r:15,c:10},e:{r:17,c:10}},// K16:K18 ì„œëª…
      {s:{r:15,c:1},e:{r:17,c:4}},  // B16:E18
      {s:{r:18,c:1},e:{r:18,c:10}}, // B19:K19
    ];

    ws['!cols'] = [
      {wch:2},{wch:8.25},{wch:11.625},{wch:4.5},{wch:5},{wch:5},
      {wch:7.5},{wch:5.75},{wch:4},{wch:8.875},{wch:4.875},{wch:14.125}
    ];
    ws['!rows'] = [
      {hpt:8.1},{hpt:8.1},{hpt:50.1},{hpt:15},{hpt:17.25},{hpt:30},
      {hpt:30},{hpt:24.95},{hpt:24.95},{hpt:24.95},{hpt:45.75},{hpt:24.95},
      {hpt:24.95},{hpt:24.95},{hpt:42.75},{hpt:20.25},{hpt:20.25},{hpt:20.25},{hpt:74.25}
    ];
    ws['!ref'] = 'A1:L19';

    var sheetName = leave.employee+'_'+leave.startDate;
    if(sheetName.length>31) sheetName=sheetName.substring(0,31);

    // ì„œëª…/ë„ì¥ ì´ë¯¸ì§€ ì‚½ì…
    if(!wb.Sheets) wb.Sheets={};
    XLSX.utils.book_append_sheet(wb, ws, sheetName);

    // ë‹´ë‹¹ì ë„ì¥ (K6:K7 ìœ„ì¹˜)
    var stampKey = 'stamp_manager';
    var signKey = 'sign_'+leave.employee;

    if(signImages[stampKey] || signImages[signKey]) {
      if(!wb['!images']) wb['!images'] = {};
      if(!wb['!images'][sheetName]) wb['!images'][sheetName] = [];
      var idx = wb.SheetNames.indexOf(sheetName);
      if(!wb.Sheets[sheetName]['!images']) wb.Sheets[sheetName]['!images'] = [];

      if(signImages[stampKey]) {
        var b64s = signImages[stampKey].split(',')[1];
        var ext = signImages[stampKey].split(';')[0].split('/')[1];
        wb.Sheets[sheetName]['!images'].push({
          name:'stamp.'+ext, data:b64s, opts:{base64:true},
          position:{type:'twoCellAnchor',
            attrs:{editAs:'oneCell'},
            from:{col:10,row:5,colOff:0,rowOff:0},
            to:{col:11,row:7,colOff:0,rowOff:0}}
        });
      }
      if(signImages[signKey]) {
        var b64e = signImages[signKey].split(',')[1];
        var exte = signImages[signKey].split(';')[0].split('/')[1];
        wb.Sheets[sheetName]['!images'].push({
          name:'sign.'+exte, data:b64e, opts:{base64:true},
          position:{type:'twoCellAnchor',
            attrs:{editAs:'oneCell'},
            from:{col:10,row:15,colOff:0,rowOff:0},
            to:{col:11,row:18,colOff:0,rowOff:0}}
        });
      }
    }
  }

  function downloadExcel() {
    if (!isAdmin) { showToast('ê´€ë¦¬ìë§Œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'error'); return; }
    var approved = leaves.filter(function(l){ return l.status === 'approved'; });
    if (approved.length === 0) { showToast('ìŠ¹ì¸ëœ íœ´ê°€ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.', 'error'); return; }

    var wb = XLSX.utils.book_new();
    approved.forEach(function(l){ makeVacationSheet(wb, l); });

    var year = new Date().getFullYear();
    XLSX.writeFile(wb, year+'ë…„_íœ´ê°€ê³„.xlsx');
    showToast('íœ´ê°€ê³„ '+approved.length+'ê±´ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
  }

  // ====== í† ìŠ¤íŠ¸ ======
  function showToast(msg, type) {
    type = type || 'success';
    var toast = document.getElementById('toast');
    document.getElementById('toastIcon').textContent = type==='success' ? 'âœ…' : 'âŒ';
    document.getElementById('toastMsg').textContent = msg;
    toast.className = 'toast ' + type + ' show';
    setTimeout(function() { toast.classList.remove('show'); }, 3000);
  }

  init();
</script>
</body>
</html>
